//
// Copyright (c) 2021 GrowStocks
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
//

@use 'sass:map';
@use 'sass:list';
@use 'sass:meta';

@use '../Feature';
@use '../Elevation';

@use 'color-validators' as validator;
@use 'color-getters' as getter;

$prefix: 'sc' !default;

@mixin apply(
    $component-name,
    $color-theme,
    $scope,
    $key,
    $settings: ()
) {

    $_init-settings: (
        opt: ('has-elevation'),
        exceptions: ()
    );

    $_scope: getter.get-scope_($scope);
    $_scope-exceptions: map.get(map.merge($_init-settings, $settings), exceptions);
    $_settings: map.get(map.merge($_init-settings, $settings), opt);
    $_elevation-color: ();

    $_init-color-theme: (
        'outline': #a0a0a0,
        'elevation': #000,
    );

    $_color-theme: map.merge($_init-color-theme, $color-theme);
    $_component-config: ($component-name, $prefix);

    // Type: color-value (hex, hsl, rgb/a, etc.)
    $_outline-color: getter.get-color_($_color-theme, 'fill', 'outline', $_component-config);
    $_elevation-color: getter.get-color_($_color-theme, 'fill', 'elevation', $_component-config);

    // Type: percent
    $_outline-opacity: 66%;

    @if Feature.has-item($_scope-exceptions, $_scope) {
        @error 'The color scope '#{$_scope}' is disabled in this component. Please select another color scope.';
    }

    @if Feature.has-item($_scope, 'text') {
        color: getter.get-color_($color-theme, 'fill', $key, $_component-config);
        border: 1px solid rgba(0 0 0 / 0);
        background: hsl(0 0% 0% / 0);
        box-shadow: none;

        @if $key == 'focus' or $key == 'active' {
            border: 1px solid rgba($_outline-color, $_outline-opacity);
        }
    }

    @if Feature.has-item($_scope, 'outlined') {

        @if $key == 'hover' or $key == 'focus' or $key == 'active' {

            color: getter.get-color_($color-theme, 'ink', $key, $_component-config);
            background: getter.get-color_($color-theme, 'fill', $key, $_component-config);
            border: 1px solid getter.get-color_($color-theme, 'fill', $key, $_component-config);
            box-shadow: none;

        } @else {

            color: getter.get-color_($color-theme, 'fill', $key, $_component-config);
            background: rgba(0 0 0 / 0);
            border: 1px solid getter.get-color_($color-theme, 'fill', $key, $_component-config);
            box-shadow: none;

        }

        @if $key == 'focus' {
            // outline: 2px solid rgba($_outline-color, $_outline-opacity);
        }
    }

    @if Feature.has-item($_scope, 'filled-unelevated') or Feature.has-item($_scope, 'filled') {
        color: getter.get-color_($color-theme, 'ink', $key, $_component-config);
        border: 1px solid getter.get-color_($color-theme, 'fill', $key, $_component-config);
        background: getter.get-color_($color-theme, 'fill', $key, $_component-config);

        @if $key == 'focus' {
            // outline: 2px solid rgba($_outline-color, $_outline-opacity);
        }

        @if Feature.has-item($_settings, 'has-elevation') {
            @if $_scope == 'filled-unelevated' {
                @if $key == 'hover' or $key == 'focus' {
                    @include Elevation.apply(3, $_elevation-color);
                } @else if $key == 'active' {
                    @include Elevation.apply(5, $_elevation-color);
                } @else {
                    box-shadow: none;
                }
            } @else if $_scope == 'filled' {
                @if $key == 'active' {
                    @include Elevation.apply(5, $_elevation-color);
                } @else {
                    @include Elevation.apply(3, $_elevation-color);
                }
            }
        }
    }
}
